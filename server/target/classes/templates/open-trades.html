<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Open Trades</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <style>
        .container-fluid {
            width: 95%;
            margin: 0 auto;
            max-width: 1400px;
        }

        .header-summary {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid var(--border-color);
        }

        .summary-item {
            text-align: center;
        }

        .summary-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            display: block;
        }

        .summary-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .account-section {
            background: var(--bg-card);
            border-radius: 10px;
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
            overflow: hidden;
            transition: transform 0.2s;
        }

        /* Real Account Highlighting */
        .account-section.real {
            border: 2px solid var(--accent-primary);
            background: linear-gradient(to right, rgba(99, 102, 241, 0.05), transparent);
            box-shadow: 0 4px 6px -1px rgba(99, 102, 241, 0.1), 0 2px 4px -1px rgba(99, 102, 241, 0.06);
        }

        .account-section.real .account-header-bar {
            background: rgba(99, 102, 241, 0.1);
            border-bottom: 1px solid var(--accent-primary);
        }

        .account-header-bar {
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.02);
            border-bottom: 1px solid var(--border-color);
        }

        .account-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .acc-name {
            font-size: 1.2rem;
            font-weight: 700;
        }

        .acc-id {
            font-family: 'JetBrains Mono', monospace;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .trades-table-container {
            padding: 0;
            overflow-x: auto;
        }

        .trades-table {
            width: 100%;
            border-collapse: collapse;
        }

        .trades-table th,
        .trades-table td {
            padding: 1rem 1.5rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .trades-table th {
            background: rgba(0, 0, 0, 0.2);
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-secondary);
        }

        .profit-positive {
            color: var(--success);
        }

        .profit-negative {
            color: var(--danger);
        }

        .back-btn {
            display: inline-flex;
            align-items: center;
            color: var(--text-secondary);
            text-decoration: none;
            margin-bottom: 1rem;
            background: var(--bg-card);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            transition: all 0.2s;
        }

        .back-btn:hover {
            color: var(--text-primary);
            border-color: var(--accent-primary);
        }
    </style>
</head>

<body>
    <div class="container-fluid" style="padding-top: 2rem;">

        <a href="/" class="back-btn">← Zurück zum Dashboard</a>

        <header class="header-summary">
            <div>
                <h1>Alle Offenen Trades</h1>
                <p class="subtitle" style="margin:0;">Übersicht aller Positionen</p>
            </div>
            <div style="display: flex; gap: 3rem;">
                <div class="summary-item">
                    <span class="summary-label">Total Trades</span>
                    <span class="summary-value" th:text="${totalTrades}">0</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Total Equity</span>
                    <span class="summary-value"
                        th:text="${#numbers.formatDecimal(totalEquity, 1, 2)} + ' ' + ${currency}">0.00 EUR</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Open Profit</span>
                    <span class="summary-value"
                        th:class="${totalProfit >= 0 ? 'summary-value profit-positive' : 'summary-value profit-negative'}"
                        th:text="${#numbers.formatDecimal(totalProfit, 1, 2)} + ' ' + ${currency}">0.00 EUR</span>
                </div>
            </div>
        </header>

        <div id="accounts-list">
            <div th:each="acc : ${accounts}" th:if="${acc.openTrades.size() > 0}"
                th:class="${acc.type == 'REAL' ? 'account-section real' : 'account-section'}">

                <div class="account-header-bar">
                    <div class="account-info">
                        <span class="acc-name"
                            th:text="${acc.name != null && !acc.name.isEmpty() ? acc.name : 'Account ' + acc.accountId}">Acc
                            Name</span>
                        <span class="acc-id" th:text="'#' + ${acc.accountId}">#123456</span>
                        <span class="badge-mini real" th:if="${acc.type == 'REAL'}"
                            style="font-size: 0.8rem; padding: 0.2rem 0.5rem;">REAL</span>
                        <span class="badge-mini demo" th:if="${acc.type == 'DEMO'}"
                            style="font-size: 0.8rem; padding: 0.2rem 0.5rem;">DEMO</span>
                    </div>
                    <div style="text-align: right;">
                        <span style="color: var(--text-secondary); font-size: 0.9rem;">Equity: </span>
                        <span style="font-weight: bold;"
                            th:text="${#numbers.formatDecimal(acc.equity, 1, 2)}">1000.00</span>
                    </div>
                </div>

                <div class="trades-table-container">
                    <table class="trades-table">
                        <thead>
                            <tr>
                                <th>Ticket</th>
                                <th>Symbol</th>
                                <th>Typ</th>
                                <th>Volumen</th>
                                <th>Open Price</th>
                                <th>Time</th>
                                <th>Profit</th>
                                <th>Status</th>
                                <th>Comment</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="trade : ${acc.openTrades}">
                                <td th:text="${trade.ticket}">123456</td>
                                <td th:text="${trade.symbol}" style="font-weight: 600;">EURUSD</td>
                                <td>
                                    <span th:class="${trade.type == 'BUY' ? 'trade-type buy' : 'trade-type sell'}"
                                        th:text="${trade.type}">BUY</span>
                                </td>
                                <td th:text="${trade.volume}">1.0</td>
                                <td th:text="${trade.openPrice}">1.0500</td>
                                <td th:text="${trade.openTime}">2024-01-01 12:00</td>
                                <td th:class="${trade.profit >= 0 ? 'profit-positive' : 'profit-negative'}"
                                    th:text="${#numbers.formatDecimal(trade.profit, 1, 2)}" style="font-weight: bold;">
                                    +50.00</td>
                                <td>
                                    <span th:if="${acc.type == 'REAL'}">
                                        <span th:if="${trade.syncStatus == 'MATCHED'}" class="check-icon"
                                            title="Matched with Demo">✅</span>
                                        <span th:if="${trade.syncStatus == 'WARNING'}" class="warning-icon"
                                            title="No matching Demo trade!">⚠️</span>
                                    </span>
                                </td>
                                <td th:text="${trade.comment}" style="color: var(--text-secondary); font-size: 0.9rem;">
                                    -</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div th:if="${totalTrades == 0}" style="text-align: center; padding: 3rem; color: var(--text-secondary);">
                <h2>Keine offenen Trades</h2>
                <p>Aktuell sind keine Positionen in den verbundenen Accounts geöffnet.</p>
            </div>
        </div>
    </div>

    <script>
        // Auto-refresh every 10 seconds to keep data fresh, but less aggressive than dashboard
        setTimeout(function () {
            location.reload();
        }, 10000);
    </script>
</body>

</html>